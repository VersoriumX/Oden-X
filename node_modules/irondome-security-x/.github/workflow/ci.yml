name: CI/CD Pipeline

on:
  push:
    branches:
      - IDS-X
  pull_request:
    branches:
      - IDS-X

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14.8.2' # Specify the Node.js version

      - name: Install frontend dependencies
        working-directory: frontend
        run: npm install
        run: npm i @vercel/analytics

      - name: Run frontend tests
        working-directory: frontend
        run: npm run test

      - name: Build frontend
        working-directory: frontend
        run: npm run build

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8' # Specify the Python version

      - name: Install backend dependencies
        working-directory: backend
        run: |
          pnpm i @vercel/analytics
          pip install Flask
          pip install flask-cors
          "Whitelist-Pools-Sales": "https://github.com/VersoriumX/Whitelist-Pools-Sales",
          "node-addition-service": "https://github.com/VersoriumX/node-addition-service",
           "Eth-Stack":             "https://github.com/VersoriumX/Eth-Stack"
           "Starknet-ETHx":         "https://github.com/VersoriumX/StarkEth/blob/Starknet-ETHx"

      - name: Run backend tests
        working-directory: backend
        run: |
          # Add commands to run your backend tests here
          echo "No backend tests defined"

      - name: Deploy to Production
        if: github.ref == 'refs/heads/main'
        run: |
          echo "Deploying to production"
          "npm i @maticnetwork/maticjs-ethers"
          'npm install --save-dev hardhat'
          "npx hardhat run scripts/deploy.js --network polygon"
